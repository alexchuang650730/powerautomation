# PowerAutomation 代码智能体需求拆解与多智能体协作文档

## 功能概述

PowerAutomation系统现已增强代码智能体(code_agent)的能力，使其能够智能分析用户输入，并根据需求类型将请求路由到最合适的智能体处理。同时，对于通用类型的请求，系统会将输入思考过程按照六大特性进行存储，并传递给MCP Planner和ThoughtActionRecorder进行处理。

## 核心功能

1. **智能需求拆解**：代码智能体能够分析用户输入，判断是代码、PPT、网页还是通用需求
2. **多智能体协作**：根据需求类型自动路由到最合适的智能体处理
3. **六特性存储**：对于通用需求，按照六大特性进行结构化存储
4. **MCP Planner集成**：将思考过程传递给MCP Planner进行规划
5. **ThoughtActionRecorder集成**：使用ThoughtActionRecorder记录六大特性
6. **无限上下文记忆**：保存用户查询历史和系统思考过程，确保交互连贯性

## 六大特性定义

1. **PowerAutomation自动化平台特性**：智能体选择与后端通信，实现智能体选择逻辑和API接口封装
2. **UI两栏布局特性**：PowerAutomation自动化平台采用两栏布局，左侧为Sidebar导航栏，右侧为主内容区
3. **提示词特性**：用户输入的提示词及系统分析结果
4. **思维特性**：系统的思考过程和决策逻辑
5. **内容特性**：处理用户输入，准备生成相应内容
6. **无限上下文记忆特性**：记录用户查询及系统思考过程，确保后续交互的连贯性和上下文理解

## 技术实现

### 前端实现

1. **agent-decomposer.js**：
   - 实现需求拆解逻辑
   - 生成六大特性
   - 与MCP Planner和ThoughtActionRecorder通信
   - 存储上下文记忆

2. **CodeAgentInput组件**：
   - 处理用户输入
   - 调用需求拆解逻辑
   - 展示拆解结果和六大特性
   - 处理智能体切换

3. **Home页面集成**：
   - 根据选择的智能体显示不同的输入组件
   - 处理智能体自动切换
   - 展示查询结果

### 后端集成

1. **MCP Planner API**：
   - 接收思考过程
   - 生成执行计划
   - 返回计划结果

2. **ThoughtActionRecorder API**：
   - 接收六大特性
   - 记录和分析特性
   - 返回分析结果

## 使用流程

1. 用户选择代码智能体
2. 输入需求并提交
3. 系统分析需求类型：
   - 如果是代码需求，由代码智能体处理
   - 如果是PPT需求，路由到PPT智能体
   - 如果是网页需求，路由到网页智能体
   - 如果是通用需求，路由到通用智能体，并存储六大特性
4. 系统将思考过程传递给MCP Planner
5. 如果是通用需求，系统使用ThoughtActionRecorder记录六大特性
6. 系统存储上下文记忆，确保后续交互的连贯性

## 测试与验证

1. **需求拆解测试**：
   - 测试代码相关关键词识别
   - 测试PPT相关关键词识别
   - 测试网页相关关键词识别
   - 测试通用需求识别

2. **多智能体路由测试**：
   - 验证路由到正确的智能体
   - 验证智能体自动切换功能

3. **六特性存储测试**：
   - 验证六大特性生成
   - 验证特性存储和检索

4. **MCP Planner集成测试**：
   - 验证思考过程传递
   - 验证计划结果处理

5. **ThoughtActionRecorder集成测试**：
   - 验证六大特性记录
   - 验证分析结果处理

## 扩展与优化

1. **关键词库扩展**：
   - 扩充代码、PPT、网页相关关键词
   - 添加更多领域的关键词

2. **需求拆解算法优化**：
   - 使用机器学习提高分类准确性
   - 添加上下文理解能力

3. **六特性生成优化**：
   - 增强特性内容的丰富度和准确性
   - 添加更多维度的特性分析

4. **用户界面优化**：
   - 提供更直观的拆解结果展示
   - 添加特性编辑功能

## 注意事项

1. 确保MCP Planner和ThoughtActionRecorder API可用
2. 处理网络错误和异常情况
3. 定期清理上下文记忆，避免存储过大
4. 保护用户隐私，不存储敏感信息
